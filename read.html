<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GrammarBuddy Read Aloud</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #f5f7fa;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        padding: 20px;
    }
    .app-container {
        background: white;
        border-radius: 16px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        width: 800px;
        max-width: 100%;
        padding: 20px;
    }
    h1 {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 1.5rem;
        margin-bottom: 10px;
    }
    .buttons {
        margin-bottom: 10px;
    }
    .buttons button {
        background: #22c55e;
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 0.9rem;
        margin-right: 5px;
    }
    .progress-bar {
        height: 6px;
        background: #e5e7eb;
        border-radius: 3px;
        margin-bottom: 15px;
        overflow: hidden;
    }
    .progress {
        height: 100%;
        width: 0%;
        background: #22c55e;
        transition: width 0.2s linear;
    }
    .scroll-container {
        height: 300px;
        overflow: hidden;
        position: relative;
    }
    .scroll-text {
        position: absolute;
        width: 100%;
        padding: 0 5px;
        line-height: 1.5rem;
    }
    #main-text {
        margin: 0;
    }
    .controls {
        margin-top: 15px;
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 10px;
    }
    .controls button {
        border: none;
        color: white;
        padding: 6px 14px;
        border-radius: 8px;
        font-size: 0.9rem;
        cursor: pointer;
    }
    .resume-btn { background: #f97316; }
    .reset-btn { background: #ef4444; }
    .speed-control {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    .overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 300px;
        background: rgba(255, 255, 255, 0.95);
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 4rem;
        font-weight: bold;
        z-index: 10;
    }
</style>
</head>
<body>
<div class="app-container">
    <h1>ðŸŽ“ GrammarBuddy Read Aloud</h1>

    <div class="buttons">
        <button id="easy-btn">Easy</button>
        <button id="difficult-btn">Difficult</button>
        <button id="hard-btn">Hard</button>
    </div>

    <div class="progress-bar">
        <div class="progress" id="progress"></div>
    </div>

    <div class="scroll-container" id="scroll-wrapper">
        <div class="scroll-text" id="scroll-text">
            <p id="main-text"></p>
        </div>
        <div class="overlay" id="overlay"></div>
    </div>

    <div class="controls">
        <div class="speed-control">
            <label><strong>Speed:</strong></label>
            <input type="range" id="speed-slider" min="50" max="300" value="150">
            <span id="speed-label">150 WPM</span>
        </div>
        <button id="resume-btn" class="resume-btn" style="display:none;">Resume</button>
        <button id="reset-btn" class="reset-btn" style="display:none;">Reset</button>
    </div>
</div>

<script>
const overlay = document.getElementById('overlay');
const mainTextElement = document.getElementById('main-text');
const scrollContainer = document.getElementById('scroll-text');
const scrollWrapper = document.getElementById('scroll-wrapper');
const progressBar = document.getElementById('progress');
const speedSlider = document.getElementById('speed-slider');
const speedLabel = document.getElementById('speed-label');
const resumeBtn = document.getElementById('resume-btn');
const resetBtn = document.getElementById('reset-btn');

let textContent = "The old lighthouse keeper, Elias, watched the sea with a practiced eye. For fifty years, the rhythm of the waves had been the only constant in his life. He had seen storms that painted the sky in shades of black and gold, and mornings where the ocean lay still, like a sheet of glass. To the townsfolk, Elias was a relic, a man anchored to the past. But to him, the lighthouse was not just stone and lightâ€”it was a promise kept, night after night.";
let animationFrameId;
let animationProgress = 0;
let lastTimestamp = 0;
let isPaused = false;
let speedInPixelsPerSecond;
let totalAnimationDuration = 60; // seconds

function setSpeed(wpm) {
    const words = textContent.trim().split(/\s+/).length;
    totalAnimationDuration = (words / wpm) * 60;
    speedLabel.textContent = `${wpm} WPM`;
}
speedSlider.addEventListener('input', e => setSpeed(+e.target.value));

function showCountdownAndStart() {
    overlay.style.display = 'flex';
    let count = 3;
    overlay.textContent = count;

    const countdownInterval = setInterval(() => {
        count--;
        if (count > 0) {
            overlay.textContent = count;
        } else {
            clearInterval(countdownInterval);
            overlay.textContent = "Get Ready to Read!";
            overlay.style.fontSize = "2rem";

            setTimeout(() => {
                overlay.style.display = 'none';
                centerTextBeforeScroll();
            }, 1000);
        }
    }, 1000);
}

function centerTextBeforeScroll() {
    mainTextElement.textContent = textContent.trim();
    const viewportHeight = scrollWrapper.clientHeight;
    const firstLineCenterOffset = viewportHeight / 2;

    scrollContainer.style.transform = `translateY(${firstLineCenterOffset}px)`;
    progressBar.style.width = '0%';

    // Wait 3 seconds before starting scroll
    setTimeout(() => startScroll(viewportHeight, firstLineCenterOffset), 3000);
}

function startScroll(viewportHeight, startingOffset) {
    const totalTextHeight = scrollContainer.scrollHeight;
    const distanceToScroll = totalTextHeight + startingOffset;
    speedInPixelsPerSecond = distanceToScroll / totalAnimationDuration;

    isPaused = false;
    animationProgress = 0;
    lastTimestamp = 0;

    function animate(timestamp) {
        if (!isPaused) {
            if (lastTimestamp === 0) lastTimestamp = timestamp;
            const deltaTime = timestamp - lastTimestamp;
            lastTimestamp = timestamp;

            animationProgress += speedInPixelsPerSecond * (deltaTime / 1000);
            scrollContainer.style.transform = `translateY(${startingOffset - animationProgress}px)`;

            const progressPercentage = (animationProgress / distanceToScroll) * 100;
            progressBar.style.width = `${Math.min(progressPercentage, 100)}%`;

            if (animationProgress < distanceToScroll) {
                animationFrameId = requestAnimationFrame(animate);
            }
        }
    }
    animationFrameId = requestAnimationFrame(animate);
}

document.getElementById('easy-btn').addEventListener('click', showCountdownAndStart);
setSpeed(+speedSlider.value);
</script>
</body>
</html>
